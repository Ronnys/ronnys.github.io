<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'/>
    <title></title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/Swiper/4.0.1/css/swiper.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <!--Swiper3.0.4-->
    <style>
        html, body {
            position: relative;
            height: 100%; font-size: 14px;
        }
        * {
            margin: 0;
            padding: 0;
        }
        #page-content {
            width: 100%;
            height: 100%;
        }

        .swiper-container{
            --swiper-theme-color: #fff;/* 设置Swiper风格 */
            --swiper-navigation-color: #fff;/* 单独设置按钮颜色 */
            --swiper-navigation-size: 30px;/* 设置按钮大小 */
        }
        p{ padding: 20px 30px}
        .banner .swiper-slide{background: no-repeat center center; background-size: cover}
        .glyphicon{ top: auto}
        .glyphicon-menu-down{
            position: fixed; bottom: 0px; left:47%; height: 50px; z-index: 9999; font-size: 26px;
            animation: rightan 1s linear 0s infinite alternate;
            -webkit-animation: rightan 1s linear 0s infinite alternate;
            -moz-animation: rightan 1s linear 0s infinite alternate;
        }
        @-webkit-keyframes rightan
        {

            from
            {
                bottom: 0;
            }
            to
            {
                bottom: -10px;
            }
        }
        .swiper-container-horizontal>.swiper-pagination-bullets, .swiper-pagination-custom, .swiper-pagination-fraction{
            bottom: 10px;
        }

        img{ vertical-align: top}
        .mould-top-pic{ text-align: center; position: relative; height: calc(100% - 300px); background: no-repeat center 0px; background-size: cover}
        .mould-bottom-text{ text-align: center; padding-top: 20px}
        .mould-bottom-text img{ height: 220px}

        .mould-title2{ padding: 20px 0 20px 0; text-align: center}
        .mould-title2 img{ height: 60px}
        .mould-bottom-tag2{text-align: center;padding-top: 20px}
        .mould-bottom-tag2 img{ height: 150px}
        .mould-banner2{ position: relative;height: calc(100% - 280px); max-height: 300px}
        .mould-banner2{ padding-bottom: 30px}

        .mould-img3{
            height: 100%; padding: 0px 20px 160px 20px; text-align: center;
        }
        .mould-img3 img{height: 100%; max-width: 100%}
        .mould-img4{
            height: 100%; margin: 0px 20px 0px 20px; text-align: center; overflow: hidden; background: no-repeat center 0px; background-size: cover
        }

    </style>
</head>
<body style="overflow:hidden">
<div class="glyphicon glyphicon-menu-down "></div>
<div class="swiper-container" id="page-content">
    <div class="swiper-wrapper">


    </div>
</div>


<script type="text/html" id="htmls">
    <div>
        <div class="swiper-slide page">
            <div class="mould-top-pic swiper-lazy" style="background-image: url('img/top1.png')">
                <div class="swiper-lazy-preloader"></div>
            </div>
            <div class="mould-bottom-text"><img src="img/text1.png"></div>
        </div>

        <div class="swiper-slide page" >
            <div class="video-module" id="J_prismPlayer1" data-url="http://event.haizitong.com/symfollies/image/Comp1.mp4" style="height: calc(100% - 145px); width: 100%"></div>
            <div style="text-align: center;margin-top: 32px"><img src="./img/p2_text.png" width="52%" ></div>
        </div>

        <div class="swiper-slide page" >
            <div class="video-module" id="J_prismPlayer2" data-url="http://event.haizitong.com/symfollies/image/Comp1.mp4" style="height: calc(100% - 145px); width: 100%"></div>
            <div style="text-align: center;margin-top: 32px"><img src="./img/p2_text.png" width="52%" ></div>
        </div>

        <div class="swiper-slide page">
            <div class="mould-top-pic" style="background-image: url('img/top2.png')"></div>
            <div class="mould-bottom-text"><img src="img/text2.png"></div>
        </div>

        <!-- 第2页 -->
        <div class="swiper-slide page">
            <div class="mould-title2"><img src="img/a1.png"></div>
            <!--左右切换照片-->
            <div class="swiper-container banner mould-banner2">
                <div class="swiper-wrapper ">
                    <div class="swiper-slide" style="background-image: url('img/a2.png')"></div>
                    <div class="swiper-slide" style="background-image: url('img/a4.png')"></div>
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-prev"></div><!--左箭头。如果放置在swiper-container外面，需要自定义样式。-->
                <div class="swiper-button-next"></div><!--右箭头。如果放置在swiper-container外面，需要自定义样式。-->
            </div>
            <div class="mould-bottom-tag2"><img src="img/a3.png"></div>
        </div>

        <!-- 第一页    -->
        <div class="swiper-slide page">
            <div class="mould-img3">
                <img src="img/pic1.png" alt="">
            </div>
        </div>

        <!-- 第一页    -->
        <div class="swiper-slide page">
            <div class="mould-img3">
                <img src="img/pic2.png" alt="">
            </div>
        </div>
        <!-- 第一页    -->
        <div class="swiper-slide page">
            <div class="mould-img3">
                <img src="img/pic3.png" alt="">
            </div>
        </div>
        <!-- 第一页    -->
        <div class="swiper-slide page">
            <div class="mould-img4" style="background-image: url('img/pic4.png')">
                <img src="" alt="">
            </div>
        </div>
        <!-- 第一页    -->
        <div class="swiper-slide page">
            <p>88</p>
        </div>
        <!-- 第一页    -->
        <div class="swiper-slide page">
            <p>99</p>
        </div>   <!-- 第一页    -->
        <div class="swiper-slide page">
            <p>10</p>
        </div>

        <div class="swiper-slide page">
            <div class="mould-title2"><img src="img/a1.png"></div>
            <!--左右切换照片-->
            <div class="swiper-container banner mould-banner2">
                <div class="swiper-wrapper ">
                    <div class="swiper-slide" style="background-image: url('img/a2.png')"></div>
                    <div class="swiper-slide" style="background-image: url('img/a4.png')"></div>
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-prev"></div><!--左箭头。如果放置在swiper-container外面，需要自定义样式。-->
                <div class="swiper-button-next"></div><!--右箭头。如果放置在swiper-container外面，需要自定义样式。-->
            </div>
            <div class="mould-bottom-tag2"><img src="img/a3.png"></div>
        </div>
    </div>
</script>

<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="https://www.swiper.com.cn/package/js/swiper.min.js"></script>
<link rel="stylesheet" href="https://g.alicdn.com/de/prismplayer/2.8.2/skins/default/aliplayer-min.css"/>
<script type="text/javascript" charset="utf-8"  src="https://g.alicdn.com/de/prismplayer/2.8.2/aliplayer-min.js"></script>
<script type="text/javascript">

    var count=$('.swiper-slide.page').length;
    var inited = false;
    var playerMap = {};

    var mySwiper = new Swiper('#page-content',{
        mousewheelControl : true,
        virtual: {
            slides: (function () {
                var slides = [];
                var htmls=$($("#htmls").html()).clone()
                htmls.find('.swiper-slide.page').each(function () {
                    slides.push($(this).html())
                })

                return slides;
            }()),
        },
        direction : 'vertical',
        lazy: {
            loadPrevNext: true,
        },
        on: {
            slideChangeTransitionEnd: function(){
                console.log(count,this.activeIndex)
                if(count==this.activeIndex+1){
                    $(".glyphicon-menu-down").hide()
                }else {
                    $(".glyphicon-menu-down").show()
                }

                var banner = $("#page-content .swiper-wrapper .swiper-slide[data-swiper-slide-index=" + this.activeIndex + "]").find(".banner")

                if(banner.length > 0) {
                    if(!$(banner[0]).data("sub-inited")) {
                        initBanner(banner[0])
                    }
                }

                if(this.activeIndex + 1 < count) {
                    checkVideo(this.activeIndex + 1)
                }

            },
            slideChange: function() {
                if(this.activeIndex - 1 >= 0) {
                    //pre
                    var page = $("#page-content .swiper-wrapper .swiper-slide[data-swiper-slide-index=" + (this.activeIndex - 1) + "]");
                    checkAndPauseVideo(page);
                }

                if(this.activeIndex + 1 < count) {
                    //next
                    var page = $("#page-content .swiper-wrapper .swiper-slide[data-swiper-slide-index=" + (this.activeIndex + 1) + "]");
                    checkAndPauseVideo(page);
                }
            },
            init: function(){
                count= this.virtual.slides.length
                initDOM()
            }
        },

    });

    var idx = 0;

    function initDOM() {
        //初始化视频
        if($(".video-module").length>0){
            $(".video-module").each(function () {
                initVideo(this);
            })
        }
    }

    function checkVideo(index) {
        var video = $("#page-content .swiper-wrapper .swiper-slide[data-swiper-slide-index=" + index + "]").find(".video-module")
        if(video.length > 0) {
            if(!$(video[0]).data("sub-inited")) {
                initVideo(video[0]);
            }
        }
    }

    function initVideo(video) {
        var $item = $(video);
        var src = $item.attr('data-url');
        var id = $item.attr('id');
        console.log(src, id);
        if(src) {
            setVideo(id, src);
            $item.data("sub-inited", "1")
        }
    }

    function initBanner(banner) {
        var mySwiperBanner = new Swiper($(banner), {
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            on: {
                init: function() {
                    console.log("init sub swiper: " + idx++);
                }
            }
        })
        mySwiperBanner.init();
        $(banner).data("sub-inited", "1")
    }

    function checkAndPauseVideo(page) {
        if(page.find("div[id^='J_prismPlayer']").length > 0) {
            var playerItem = page.find("div[id^='J_prismPlayer']")[0];
            var playerId = $(playerItem).attr("id");
            var player = playerMap[playerId];
            // console.log(playerId, "isPlaying=" + player.getStatus());
            if(player.getStatus() == 'playing') {
                player.pause();
                console.log(playerId, "pause player")
            }
        }
    }


    function setVideo(id,url) {
        console.log("setVide: ", id);
        var aliplayer = new Aliplayer({
                "id": id,
                "source": url,
                "width": "100%",
                "height": "100%",
                "autoplay": false,
                "isLive": false,
                "rePlay": false,
                "playsinline": true,
                "preload": true,
                "controlBarVisibility": "hover",// 视频设置面板怎么显示 always永久显示  click点击显示 hover鼠标移动上去显示
                "useH5Prism": true,
                "skinLayout": [
                    {name: "bigPlayButton", align: "cc"},
                    {
                        "name": "H5Loading",
                        "align": "cc"
                    },
                    {
                        "name": "errorDisplay",
                        "align": "tlabs",
                        "x": 0,
                        "y": 0
                    },
                    {
                        "name": "infoDisplay"
                    },
                    {
                        "name": "tooltip",
                        "align": "blabs",
                        "x": 0,
                        "y": 56
                    },
                    {
                        "name": "thumbnail"
                    },
                    {
                        "name": "controlBar",
                        "align": "blabs",
                        "x": 0,
                        "y": 0,
                        "children": [
                            {
                                "name": "progress",
                                "align": "blabs",
                                "x": 0,
                                "y": 44
                            },
                            {
                                "name": "playButton",
                                "align": "tl",
                                "x": 15,
                                "y": 12
                            },
                            {
                                "name": "timeDisplay",
                                "align": "tl",
                                "x": 10,
                                "y": 7
                            },
                            {
                                "name": "fullScreenButton",
                                "align": "tr",
                                "x": 10,
                                "y": 12
                            },
                            {
                                "name": "subtitle",
                                "align": "tr",
                                "x": 15,
                                "y": 12
                            },
                            {
                                "name": "setting",
                                "align": "tr",
                                "x": 15,
                                "y": 12
                            },
                            {
                                "name": "volume",
                                "align": "tr",
                                "x": 5,
                                "y": 10
                            }
                        ]
                    }
                ]
            }, function (player) {
                console.log("The player is created");
            },
        );
        var _video = $("#" + id).find('video')[0];
        aliplayer.on('play', function (e) {
            _video.removeEventListener('click', play);
            _video.addEventListener('click', pause);
        });
        aliplayer.on('pause', function (e) {
            _video.removeEventListener('click', pause);
            _video.addEventListener('click', play)
        });
        function play() {
            if (aliplayer) aliplayer.play();
        }

        function pause() {
            if (aliplayer) aliplayer.pause();
        }

        playerMap[id] = aliplayer
    }


</script>
</body>
</html>
